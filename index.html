<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DocBuilder - Visual Documentation Tool</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #fafaf9;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f5f5f4;
      --text-primary: #1c1917;
      --text-secondary: #57534e;
      --text-tertiary: #a8a29e;
      --accent: #0f172a;
      --accent-soft: #334155;
      --border: #e7e5e4;
      --border-dark: #d6d3d1;
      --success: #059669;
      --success-bg: #d1fae5;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    h1, h2, h3 {
      font-family: 'Crimson Pro', Georgia, serif;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }

    .logo {
      font-family: 'Crimson Pro', serif;
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--accent);
      letter-spacing: -0.03em;
    }

    .header-actions {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    /* Buttons */
    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'DM Sans', sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover {
      background: var(--accent-soft);
      box-shadow: var(--shadow);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border-dark);
    }

    .btn-secondary:hover {
      background: var(--bg-secondary);
      border-color: var(--accent);
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
      padding: 0.5rem 1rem;
    }

    .btn-ghost:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Upload View */
    .upload-view {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 3rem 2rem;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    .upload-hero {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.6s ease;
    }

    .upload-hero h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      color: var(--accent);
    }

    .upload-hero p {
      font-size: 1.125rem;
      color: var(--text-secondary);
    }

    .dropzone {
      border: 2px dashed var(--border-dark);
      border-radius: 12px;
      padding: 4rem 2rem;
      text-align: center;
      background: var(--bg-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 2rem;
      animation: fadeInUp 0.6s ease 0.1s backwards;
    }

    .dropzone.active {
      border-color: var(--accent);
      background: rgba(15, 23, 42, 0.02);
      transform: scale(1.01);
    }

    .dropzone:hover {
      border-color: var(--accent);
      box-shadow: var(--shadow);
    }

    .dropzone-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.4;
    }

    .dropzone-text {
      font-size: 1.125rem;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .dropzone-subtext {
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .thumbnail-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      animation: fadeInUp 0.6s ease 0.2s backwards;
    }

    .thumbnail-item {
      position: relative;
      aspect-ratio: 3/4;
      border-radius: 8px;
      overflow: hidden;
      background: var(--bg-secondary);
      box-shadow: var(--shadow-sm);
      transition: all 0.3s ease;
      cursor: move;
      border: 2px solid transparent;
    }

    .thumbnail-item:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-4px);
      border-color: var(--accent);
    }

    .thumbnail-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .thumbnail-remove {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .thumbnail-item:hover .thumbnail-remove {
      opacity: 1;
    }

    .thumbnail-order {
      position: absolute;
      bottom: 0.5rem;
      left: 0.5rem;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    /* Editor View */
    .editor-view {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 500px;
      gap: 0;
      height: calc(100vh - 73px);
      overflow: hidden;
    }

    .image-panel {
      background: var(--bg-tertiary);
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--border);
    }

    .image-display {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
    }

    .image-display img {
      max-width: 100%;
      max-height: calc(100vh - 300px);
      object-fit: contain;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      animation: fadeIn 0.3s ease;
    }

    .image-counter {
      position: absolute;
      top: 1.5rem;
      left: 1.5rem;
      background: rgba(255, 255, 255, 0.95);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      box-shadow: var(--shadow-sm);
    }

    .image-nav {
      display: flex;
      gap: 1rem;
      justify-content: center;
      padding: 1.5rem;
    }

    .thumbnail-strip {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      padding: 1rem;
      overflow-x: auto;
      display: flex;
      gap: 0.75rem;
      max-height: 140px;
    }

    .thumbnail-strip-item {
      flex-shrink: 0;
      width: 80px;
      height: 100px;
      border-radius: 4px;
      overflow: hidden;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .thumbnail-strip-item:hover {
      border-color: var(--accent-soft);
      transform: scale(1.05);
    }

    .thumbnail-strip-item.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent);
    }

    .thumbnail-strip-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .options-panel {
      background: var(--bg-secondary);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .options-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .options-header h2 {
      font-size: 1.5rem;
      color: var(--accent);
    }

    .options-list {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .option-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--border);
      background: var(--bg-primary);
    }

    .option-item:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-dark);
    }

    .option-item.selected {
      background: var(--success-bg);
      border-color: var(--success);
    }

    .option-group {
      margin-bottom: 1.5rem;
    }

    .option-group-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 0.75rem;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid var(--border);
    }

    .option-group-header:hover {
      background: var(--border);
    }

    .option-group-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .option-group-toggle {
      font-size: 1.25rem;
      transition: transform 0.2s ease;
      color: var(--text-secondary);
    }

    .option-group-toggle.collapsed {
      transform: rotate(-90deg);
    }

    .option-group-content {
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease, opacity 0.3s ease;
      opacity: 1;
    }

    .option-group-content.collapsed {
      max-height: 0;
      opacity: 0;
    }

    .option-group-badge {
      background: var(--accent);
      color: white;
      padding: 0.125rem 0.5rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .option-checkbox {
      margin-top: 0.25rem;
      width: 18px;
      height: 18px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-content {
      flex: 1;
    }

    .option-label {
      font-weight: 500;
      margin-bottom: 0.25rem;
      color: var(--text-primary);
    }

    .option-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .preview-section {
      border-top: 1px solid var(--border);
      padding: 1.5rem;
      background: var(--bg-tertiary);
      max-height: 300px;
      overflow-y: auto;
    }

    .preview-section h3 {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
    }

    .preview-item {
      margin-bottom: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 6px;
      border-left: 3px solid var(--success);
      font-size: 0.875rem;
      line-height: 1.6;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.2s ease;
      padding: 2rem;
    }

    .modal {
      background: var(--bg-secondary);
      border-radius: 12px;
      width: 100%;
      max-width: 700px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
      animation: slideUp 0.3s ease;
    }

    .modal-header {
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 1.5rem;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 1.5rem 2rem;
    }

    .modal-footer {
      padding: 1.5rem 2rem;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    .editable-option {
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      background: var(--bg-primary);
      transition: all 0.2s ease;
    }

    .editable-option:hover {
      border-color: var(--border-dark);
      box-shadow: var(--shadow-sm);
    }

    .editable-option-header {
      display: flex;
      gap: 1rem;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .drag-handle {
      cursor: move;
      color: var(--text-tertiary);
      font-size: 1.25rem;
      padding-top: 0.25rem;
    }

    .editable-option input {
      flex: 1;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.625rem 0.875rem;
      font-size: 1rem;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-secondary);
      transition: all 0.2s ease;
    }

    .editable-option input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    .editable-option textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 0.875rem;
      font-family: 'DM Sans', sans-serif;
      line-height: 1.6;
      resize: vertical;
      min-height: 100px;
      background: var(--bg-secondary);
      transition: all 0.2s ease;
    }

    .editable-option textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    .option-actions {
      display: flex;
      gap: 0.5rem;
    }

    .btn-icon {
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      border: 1px solid var(--border);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-icon:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--border-dark);
    }

    .btn-icon.danger:hover {
      background: #fef2f2;
      color: #dc2626;
      border-color: #fecaca;
    }

    .group-management {
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 2px solid var(--border);
    }

    .group-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .group-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-primary);
      transition: all 0.2s ease;
    }

    .group-item:hover {
      border-color: var(--border-dark);
      box-shadow: var(--shadow-sm);
    }

    .group-item input {
      flex: 1;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      font-size: 0.95rem;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-secondary);
      font-weight: 500;
    }

    .section-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
      margin-top: 0.5rem;
    }

    .option-group-selector {
      margin-bottom: 1rem;
    }

    .option-group-selector label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
    }

    .option-group-selector select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.5rem;
      font-size: 0.875rem;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-secondary);
    }

    /* Export View */
    .export-view {
      flex: 1;
      padding: 3rem 2rem;
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
    }

    .export-view h1 {
      font-size: 2.5rem;
      margin-bottom: 2rem;
      color: var(--accent);
    }

    .export-settings {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .setting-group {
      margin-bottom: 1.5rem;
    }

    .setting-group:last-child {
      margin-bottom: 0;
    }

    .setting-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .setting-group input,
    .setting-group select {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem;
      font-size: 1rem;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-primary);
      transition: all 0.2s ease;
    }

    .setting-group input:focus,
    .setting-group select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
    }

    .layout-options {
      display: flex;
      gap: 1rem;
      flex-direction: column;
    }

    .layout-option {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .layout-option:hover {
      border-color: var(--border-dark);
      background: var(--bg-tertiary);
    }

    .layout-option input[type="radio"] {
      width: auto;
    }

    .export-summary {
      background: var(--bg-tertiary);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .export-summary h3 {
      font-size: 1rem;
      margin-bottom: 1rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
    }

    .export-summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.875rem;
    }

    .export-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    /* Progress */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .progress-fill {
      height: 100%;
      background: var(--accent);
      transition: width 0.3s ease;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-tertiary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-dark);
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-tertiary);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: var(--text-secondary);
    }

    .empty-state-icon {
      font-size: 4rem;
      opacity: 0.3;
      margin-bottom: 1rem;
    }

    .empty-state h3 {
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    /* Input file hidden */
input[type="file"] {
  opacity: 0;
  position: absolute;
  width: 0.1px;
  height: 0.1px;
  pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useReducer, useCallback, useRef } = React;

    // Utility Functions
    const generateId = () => Math.random().toString(36).substr(2, 9);

    const createThumbnail = (file) => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (e) => resolve(e.target.result);
        reader.readAsDataURL(file);
      });
    };

    // Initial State
    const initialState = {
      images: [],
      optionGroups: [
        {
          id: 'group1',
          name: 'Technical Details',
          order: 0,
          collapsed: false
        },
        {
          id: 'group2',
          name: 'Quality & Safety',
          order: 1,
          collapsed: false
        }
      ],
      toggleOptions: [
        {
          id: '1',
          label: 'Installation Details',
          content: 'This section documents the installation process, including mounting specifications, hardware used, and environmental conditions at the time of installation.',
          order: 0,
          groupId: 'group1',
          isActive: true
        },
        {
          id: '2',
          label: 'Measurements',
          content: 'Precise dimensional measurements including length, width, height, clearances, and tolerances as per specification documents.',
          order: 1,
          groupId: 'group1',
          isActive: true
        },
        {
          id: '3',
          label: 'Material Specifications',
          content: 'Detailed material composition, grade specifications, manufacturer information, and certification documentation.',
          order: 2,
          groupId: 'group1',
          isActive: true
        },
        {
          id: '4',
          label: 'Quality Assessment',
          content: 'Visual inspection results showing the condition of materials, finish quality, and any defects or concerns identified during the assessment.',
          order: 3,
          groupId: 'group2',
          isActive: true
        },
        {
          id: '5',
          label: 'Safety Compliance',
          content: 'Documentation of safety standards compliance, including regulatory requirements, certification marks, and safety feature verification.',
          order: 4,
          groupId: 'group2',
          isActive: true
        }
      ],
      currentImageIndex: 0,
      viewMode: 'upload',
      project: {
        name: 'Documentation Project',
        createdAt: new Date(),
        lastModified: new Date()
      },
      exportSettings: {
        title: 'Documentation Report',
        pageSize: 'letter',
        layout: 'side-by-side'
      }
    };

    // Reducer
    const appReducer = (state, action) => {
      switch (action.type) {
        case 'ADD_IMAGES':
          return {
            ...state,
            images: [...state.images, ...action.payload],
            viewMode: state.images.length === 0 && action.payload.length > 0 ? 'edit' : state.viewMode
          };
        
        case 'REMOVE_IMAGE':
          return {
            ...state,
            images: state.images.filter(img => img.id !== action.payload)
          };
        
        case 'SET_CURRENT_IMAGE':
          return {
            ...state,
            currentImageIndex: action.payload
          };
        
        case 'TOGGLE_OPTION':
          return {
            ...state,
            images: state.images.map(img =>
              img.id === action.payload.imageId
                ? {
                    ...img,
                    selectedOptions: img.selectedOptions.includes(action.payload.optionId)
                      ? img.selectedOptions.filter(id => id !== action.payload.optionId)
                      : [...img.selectedOptions, action.payload.optionId]
                  }
                : img
            )
          };
        
        case 'ADD_TOGGLE_OPTION':
          return {
            ...state,
            toggleOptions: [...state.toggleOptions, action.payload]
          };
        
        case 'UPDATE_TOGGLE_OPTION':
          return {
            ...state,
            toggleOptions: state.toggleOptions.map(opt =>
              opt.id === action.payload.id
                ? { ...opt, ...action.payload.updates }
                : opt
            )
          };
        
        case 'DELETE_TOGGLE_OPTION':
          return {
            ...state,
            toggleOptions: state.toggleOptions.filter(opt => opt.id !== action.payload),
            images: state.images.map(img => ({
              ...img,
              selectedOptions: img.selectedOptions.filter(id => id !== action.payload)
            }))
          };
        
        case 'ADD_GROUP':
          return {
            ...state,
            optionGroups: [...state.optionGroups, action.payload]
          };
        
        case 'UPDATE_GROUP':
          return {
            ...state,
            optionGroups: state.optionGroups.map(group =>
              group.id === action.payload.id
                ? { ...group, ...action.payload.updates }
                : group
            )
          };
        
        case 'DELETE_GROUP':
          return {
            ...state,
            optionGroups: state.optionGroups.filter(group => group.id !== action.payload),
            toggleOptions: state.toggleOptions.map(opt =>
              opt.groupId === action.payload ? { ...opt, groupId: null } : opt
            )
          };
        
        case 'TOGGLE_GROUP_COLLAPSE':
          return {
            ...state,
            optionGroups: state.optionGroups.map(group =>
              group.id === action.payload
                ? { ...group, collapsed: !group.collapsed }
                : group
            )
          };
        
        case 'SET_VIEW_MODE':
          return {
            ...state,
            viewMode: action.payload
          };
        
        case 'UPDATE_EXPORT_SETTINGS':
          return {
            ...state,
            exportSettings: { ...state.exportSettings, ...action.payload }
          };
        
        default:
          return state;
      }
    };

    // Components
    const Header = ({ state, dispatch, onExport }) => {
      return (
        <div className="header">
          <div className="logo">DocBuilder</div>
          <div className="header-actions">
            {state.viewMode === 'edit' && (
              <>
                <button 
                  className="btn btn-ghost"
                  onClick={() => dispatch({ type: 'SET_VIEW_MODE', payload: 'upload' })}
                >
                  ‚Üê Back to Upload
                </button>
                <button 
                  className="btn btn-primary"
                  onClick={() => dispatch({ type: 'SET_VIEW_MODE', payload: 'export' })}
                  disabled={state.images.length === 0}
                >
                  Export to DOCX
                </button>
              </>
            )}
            {state.viewMode === 'export' && (
              <button 
                className="btn btn-ghost"
                onClick={() => dispatch({ type: 'SET_VIEW_MODE', payload: 'edit' })}
              >
                ‚Üê Back to Editor
              </button>
            )}
          </div>
        </div>
      );
    };

    const UploadView = ({ state, dispatch }) => {
      const [dragActive, setDragActive] = useState(false);
      const fileInputRef = useRef(null);

      const handleFiles = async (files) => {
        const imageFiles = Array.from(files).filter(file => 
          file.type.startsWith('image/')
        );

        const processedImages = await Promise.all(
          imageFiles.map(async (file, index) => {
            const thumbnail = await createThumbnail(file);
            return {
              id: generateId(),
              file,
              thumbnail,
              fullImage: thumbnail,
              order: state.images.length + index,
              selectedOptions: [],
              uploadedAt: new Date()
            };
          })
        );

        dispatch({ type: 'ADD_IMAGES', payload: processedImages });
      };

      const handleDrop = (e) => {
        e.preventDefault();
        e.stopPropagation();
        setDragActive(false);
        
        if (e.dataTransfer.files) {
          handleFiles(e.dataTransfer.files);
        }
      };

      const handleDrag = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (e.type === "dragenter" || e.type === "dragover") {
          setDragActive(true);
        } else if (e.type === "dragleave") {
          setDragActive(false);
        }
      };

      return (
        <div className="upload-view">
          <div className="upload-hero">
            <h1>Create Visual Documentation</h1>
            <p>Upload your images and pair them with detailed annotations</p>
          </div>

          <div
            className={`dropzone ${dragActive ? 'active' : ''}`}
            onDrop={handleDrop}
            onDragOver={handleDrag}
            onDragEnter={handleDrag}
            onDragLeave={handleDrag}
            onClick={() => fileInputRef.current?.click()}
          >
            <div className="dropzone-icon">üì∏</div>
            <div className="dropzone-text">Drop images here or click to browse</div>
            <div className="dropzone-subtext">Supports JPG, PNG, GIF ‚Ä¢ Up to 200 images</div>
            <input
              ref={fileInputRef}
              type="file"
              multiple
              accept="image/*"
              onChange={(e) => handleFiles(e.target.files)}
            />
          </div>

          {state.images.length > 0 && (
            <>
              <div style={{ marginBottom: '1rem', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <h2 style={{ fontSize: '1.5rem', color: 'var(--text-primary)' }}>
                  {state.images.length} {state.images.length === 1 ? 'Image' : 'Images'} Uploaded
                </h2>
                <button 
                  className="btn btn-primary"
                  onClick={() => dispatch({ type: 'SET_VIEW_MODE', payload: 'edit' })}
                >
                  Continue to Editor ‚Üí
                </button>
              </div>
              
              <div className="thumbnail-grid">
                {state.images.map((image, index) => (
                  <div key={image.id} className="thumbnail-item">
                    <img src={image.thumbnail} alt={`Upload ${index + 1}`} />
                    <button
                      className="thumbnail-remove"
                      onClick={(e) => {
                        e.stopPropagation();
                        dispatch({ type: 'REMOVE_IMAGE', payload: image.id });
                      }}
                    >
                      √ó
                    </button>
                    <div className="thumbnail-order">{index + 1}</div>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      );
    };

    const EditorView = ({ state, dispatch }) => {
      const [showOptionsEditor, setShowOptionsEditor] = useState(false);
      const currentImage = state.images[state.currentImageIndex];

      useEffect(() => {
        const handleKeyPress = (e) => {
          if (e.key === 'ArrowLeft' && state.currentImageIndex > 0) {
            dispatch({ type: 'SET_CURRENT_IMAGE', payload: state.currentImageIndex - 1 });
          } else if (e.key === 'ArrowRight' && state.currentImageIndex < state.images.length - 1) {
            dispatch({ type: 'SET_CURRENT_IMAGE', payload: state.currentImageIndex + 1 });
          }
        };

        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
      }, [state.currentImageIndex, state.images.length]);

      if (!currentImage) {
        return (
          <div className="empty-state">
            <div className="empty-state-icon">üì∑</div>
            <h3>No images uploaded</h3>
            <p>Go back to upload view to add images</p>
          </div>
        );
      }

      return (
        <>
          <div className="editor-view">
            <div className="image-panel">
              <div className="image-display">
                <div className="image-counter">
                  Image {state.currentImageIndex + 1} of {state.images.length}
                </div>
                <img src={currentImage.fullImage} alt="Current" />
              </div>
              
              <div className="image-nav">
                <button
                  className="btn btn-secondary"
                  onClick={() => dispatch({ type: 'SET_CURRENT_IMAGE', payload: state.currentImageIndex - 1 })}
                  disabled={state.currentImageIndex === 0}
                >
                  ‚Üê Previous
                </button>
                <button
                  className="btn btn-secondary"
                  onClick={() => dispatch({ type: 'SET_CURRENT_IMAGE', payload: state.currentImageIndex + 1 })}
                  disabled={state.currentImageIndex === state.images.length - 1}
                >
                  Next ‚Üí
                </button>
              </div>

              <div className="thumbnail-strip">
                {state.images.map((image, index) => (
                  <div
                    key={image.id}
                    className={`thumbnail-strip-item ${index === state.currentImageIndex ? 'active' : ''}`}
                    onClick={() => dispatch({ type: 'SET_CURRENT_IMAGE', payload: index })}
                  >
                    <img src={image.thumbnail} alt={`Thumbnail ${index + 1}`} />
                  </div>
                ))}
              </div>
            </div>

            <div className="options-panel">
              <div className="options-header">
                <h2>Options</h2>
                <button
                  className="btn btn-secondary"
                  onClick={() => setShowOptionsEditor(true)}
                >
                  Edit Options
                </button>
              </div>

              <div className="options-list">
                {state.optionGroups
                  .sort((a, b) => a.order - b.order)
                  .map(group => {
                    const groupOptions = state.toggleOptions
                      .filter(opt => opt.groupId === group.id)
                      .sort((a, b) => a.order - b.order);
                    
                    const selectedCount = groupOptions.filter(opt => 
                      currentImage.selectedOptions.includes(opt.id)
                    ).length;

                    return (
                      <div key={group.id} className="option-group">
                        <div 
                          className="option-group-header"
                          onClick={() => dispatch({ type: 'TOGGLE_GROUP_COLLAPSE', payload: group.id })}
                        >
                          <div className="option-group-title">
                            <span className={`option-group-toggle ${group.collapsed ? 'collapsed' : ''}`}>
                              ‚ñº
                            </span>
                            {group.name}
                            {selectedCount > 0 && (
                              <span className="option-group-badge">{selectedCount}</span>
                            )}
                          </div>
                        </div>
                        
                        <div className={`option-group-content ${group.collapsed ? 'collapsed' : ''}`}>
                          {groupOptions.map(option => (
                            <div
                              key={option.id}
                              className={`option-item ${currentImage.selectedOptions.includes(option.id) ? 'selected' : ''}`}
                              onClick={() => dispatch({
                                type: 'TOGGLE_OPTION',
                                payload: { imageId: currentImage.id, optionId: option.id }
                              })}
                            >
                              <input
                                type="checkbox"
                                className="option-checkbox"
                                checked={currentImage.selectedOptions.includes(option.id)}
                                onChange={() => {}}
                              />
                              <div className="option-content">
                                <div className="option-label">{option.label}</div>
                                <div className="option-text">{option.content}</div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })}
                
                {/* Ungrouped options */}
                {state.toggleOptions.filter(opt => !opt.groupId).length > 0 && (
                  <div className="option-group">
                    <div className="option-group-header" style={{ cursor: 'default', background: 'var(--bg-primary)' }}>
                      <div className="option-group-title">
                        Uncategorized
                      </div>
                    </div>
                    <div className="option-group-content">
                      {state.toggleOptions
                        .filter(opt => !opt.groupId)
                        .sort((a, b) => a.order - b.order)
                        .map(option => (
                          <div
                            key={option.id}
                            className={`option-item ${currentImage.selectedOptions.includes(option.id) ? 'selected' : ''}`}
                            onClick={() => dispatch({
                              type: 'TOGGLE_OPTION',
                              payload: { imageId: currentImage.id, optionId: option.id }
                            })}
                          >
                            <input
                              type="checkbox"
                              className="option-checkbox"
                              checked={currentImage.selectedOptions.includes(option.id)}
                              onChange={() => {}}
                            />
                            <div className="option-content">
                              <div className="option-label">{option.label}</div>
                              <div className="option-text">{option.content}</div>
                            </div>
                          </div>
                        ))}
                    </div>
                  </div>
                )}
              </div>

              <div className="preview-section">
                <h3>Selected Content</h3>
                {currentImage.selectedOptions.length === 0 ? (
                  <p style={{ color: 'var(--text-secondary)', fontSize: '0.875rem' }}>
                    No options selected for this image
                  </p>
                ) : (
                  currentImage.selectedOptions.map(optionId => {
                    const option = state.toggleOptions.find(o => o.id === optionId);
                    return option ? (
                      <div key={optionId} className="preview-item">
                        <strong>{option.label}:</strong> {option.content}
                      </div>
                    ) : null;
                  })
                )}
              </div>
            </div>
          </div>

          {showOptionsEditor && (
            <OptionsEditorModal
              state={state}
              dispatch={dispatch}
              onClose={() => setShowOptionsEditor(false)}
            />
          )}
        </>
      );
    };

    const OptionsEditorModal = ({ state, dispatch, onClose }) => {
      const handleAdd = () => {
        const newOption = {
          id: generateId(),
          label: 'New Option',
          content: 'Enter description here...',
          order: state.toggleOptions.length,
          groupId: state.optionGroups[0]?.id || null,
          isActive: true
        };
        dispatch({ type: 'ADD_TOGGLE_OPTION', payload: newOption });
      };

      const handleUpdate = (id, updates) => {
        dispatch({ type: 'UPDATE_TOGGLE_OPTION', payload: { id, updates } });
      };

      const handleDelete = (id) => {
        if (confirm('Are you sure you want to delete this option?')) {
          dispatch({ type: 'DELETE_TOGGLE_OPTION', payload: id });
        }
      };

      const handleAddGroup = () => {
        const newGroup = {
          id: generateId(),
          name: 'New Group',
          order: state.optionGroups.length,
          collapsed: false
        };
        dispatch({ type: 'ADD_GROUP', payload: newGroup });
      };

      const handleUpdateGroup = (id, updates) => {
        dispatch({ type: 'UPDATE_GROUP', payload: { id, updates } });
      };

      const handleDeleteGroup = (id) => {
        if (confirm('Are you sure you want to delete this group? Options will be moved to Uncategorized.')) {
          dispatch({ type: 'DELETE_GROUP', payload: id });
        }
      };

      return (
        <div className="modal-overlay" onClick={onClose}>
          <div className="modal" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h2>Manage Options & Groups</h2>
              <button className="modal-close" onClick={onClose}>√ó</button>
            </div>

            <div className="modal-body">
              {/* Group Management Section */}
              <div className="group-management">
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                  <h3 className="section-title">Groups</h3>
                  <button className="btn btn-secondary" onClick={handleAddGroup} style={{ padding: '0.5rem 1rem', fontSize: '0.875rem' }}>
                    + Add Group
                  </button>
                </div>
                
                <div className="group-list">
                  {state.optionGroups.map((group) => (
                    <div key={group.id} className="group-item">
                      <div className="drag-handle">‚ãÆ‚ãÆ</div>
                      <input
                        type="text"
                        value={group.name}
                        onChange={(e) => handleUpdateGroup(group.id, { name: e.target.value })}
                        placeholder="Group name"
                      />
                      <button
                        className="btn-icon danger"
                        onClick={() => handleDeleteGroup(group.id)}
                        title="Delete group"
                      >
                        üóë
                      </button>
                    </div>
                  ))}
                </div>
              </div>

              {/* Options Section */}
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>
                <h3 className="section-title">Options</h3>
                <button className="btn btn-primary" onClick={handleAdd} style={{ padding: '0.5rem 1rem', fontSize: '0.875rem' }}>
                  + Add Option
                </button>
              </div>

              {state.toggleOptions.map((option, index) => (
                <div key={option.id} className="editable-option">
                  <div className="editable-option-header">
                    <div className="drag-handle">‚ãÆ‚ãÆ</div>
                    <input
                      type="text"
                      value={option.label}
                      onChange={(e) => handleUpdate(option.id, { label: e.target.value })}
                      placeholder="Option label"
                    />
                    <div className="option-actions">
                      <button
                        className="btn-icon danger"
                        onClick={() => handleDelete(option.id)}
                        title="Delete"
                      >
                        üóë
                      </button>
                    </div>
                  </div>
                  
                  <div className="option-group-selector">
                    <label>Group</label>
                    <select
                      value={option.groupId || ''}
                      onChange={(e) => handleUpdate(option.id, { groupId: e.target.value || null })}
                    >
                      <option value="">Uncategorized</option>
                      {state.optionGroups.map(group => (
                        <option key={group.id} value={group.id}>{group.name}</option>
                      ))}
                    </select>
                  </div>
                  
                  <textarea
                    value={option.content}
                    onChange={(e) => handleUpdate(option.id, { content: e.target.value })}
                    placeholder="Option content"
                  />
                </div>
              ))}
            </div>

            <div className="modal-footer">
              <button className="btn btn-primary" onClick={onClose}>
                Done
              </button>
            </div>
          </div>
        </div>
      );
    };

    const ExportView = ({ state, dispatch }) => {
      const [exporting, setExporting] = useState(false);
      const [progress, setProgress] = useState(0);

      const handleExport = async () => {
        setExporting(true);
        setProgress(0);

        try {
          // Check if docx library is loaded
          if (typeof docx === 'undefined') {
            throw new Error('DOCX library not loaded. Please refresh the page and try again.');
          }

          const { Document, Packer, Paragraph, ImageRun, TextRun, Table, TableRow, TableCell, 
                  WidthType, PageBreak, AlignmentType, BorderStyle, VerticalAlign } = docx;

          const sections = [];
          const totalImages = state.images.length;

          for (let i = 0; i < state.images.length; i++) {
            const image = state.images[i];
            setProgress(((i + 1) / totalImages) * 100);

            // Get selected content
            const selectedContent = image.selectedOptions
              .map(optionId => state.toggleOptions.find(o => o.id === optionId))
              .filter(Boolean);

            // Convert image to buffer
            const response = await fetch(image.fullImage);
            const blob = await response.blob();
            const arrayBuffer = await blob.arrayBuffer();

            const border = { style: BorderStyle.SINGLE, size: 1, color: "CCCCCC" };
            const borders = { top: border, bottom: border, left: border, right: border };

            if (state.exportSettings.layout === 'side-by-side') {
              sections.push(
                new Table({
                  width: { size: 100, type: WidthType.PERCENTAGE },
                  columnWidths: [4680, 4680],
                  rows: [
                    new TableRow({
                      children: [
                        new TableCell({
                          borders,
                          width: { size: 4680, type: WidthType.DXA },
                          margins: { top: 80, bottom: 80, left: 120, right: 120 },
                          verticalAlign: VerticalAlign.CENTER,
                          children: [
                            new Paragraph({
                              children: [
                                new ImageRun({
                                  data: arrayBuffer,
                                  transformation: { width: 280, height: 350 },
                                  type: image.file.type.split('/')[1] || 'png'
                                })
                              ],
                              alignment: AlignmentType.CENTER
                            })
                          ]
                        }),
                        new TableCell({
                          borders,
                          width: { size: 4680, type: WidthType.DXA },
                          margins: { top: 80, bottom: 80, left: 120, right: 120 },
                          children: [
                            new Paragraph({
                              children: [new TextRun({ text: `Image ${i + 1}`, bold: true, size: 28 })],
                              spacing: { after: 200 }
                            }),
                            ...selectedContent.map(opt => 
                              new Paragraph({
                                children: [
                                  new TextRun({ text: opt.label + ': ', bold: true }),
                                  new TextRun({ text: opt.content })
                                ],
                                spacing: { after: 200 }
                              })
                            )
                          ]
                        })
                      ]
                    })
                  ]
                })
              );
            } else {
              // Stacked layout
              sections.push(
                new Paragraph({
                  children: [
                    new ImageRun({
                      data: arrayBuffer,
                      transformation: { width: 400, height: 500 },
                      type: image.file.type.split('/')[1] || 'png'
                    })
                  ],
                  alignment: AlignmentType.CENTER,
                  spacing: { after: 300 }
                }),
                new Paragraph({
                  children: [new TextRun({ text: `Image ${i + 1}`, bold: true, size: 28 })],
                  spacing: { after: 200 }
                }),
                ...selectedContent.map(opt => 
                  new Paragraph({
                    children: [
                      new TextRun({ text: opt.label + ': ', bold: true }),
                      new TextRun({ text: opt.content })
                    ],
                    spacing: { after: 200 }
                  })
                )
              );
            }

            if (i < state.images.length - 1) {
              sections.push(new Paragraph({ children: [new PageBreak()] }));
            }
          }

          const doc = new Document({
            sections: [{
              properties: {
                page: {
                  size: { width: 12240, height: 15840 },
                  margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
                }
              },
              children: [
                new Paragraph({
                  children: [new TextRun({ text: state.exportSettings.title, bold: true, size: 48 })],
                  spacing: { after: 400 },
                  alignment: AlignmentType.CENTER
                }),
                new Paragraph({ children: [new PageBreak()] }),
                ...sections
              ]
            }]
          });

          const blob = await Packer.toBlob(doc);
          
          // Use FileSaver.js if available, otherwise fallback to manual download
          if (typeof saveAs !== 'undefined') {
            saveAs(blob, `${state.exportSettings.title}.docx`);
          } else {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${state.exportSettings.title}.docx`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          }

          setProgress(100);
          setTimeout(() => {
            setExporting(false);
            setProgress(0);
          }, 1000);

        } catch (error) {
          console.error('Export error:', error);
          alert(`Export failed: ${error.message}\n\nPlease refresh the page and try again.`);
          setExporting(false);
          setProgress(0);
        }
      };

      return (
        <div className="export-view">
          <h1>Export Documentation</h1>

          <div className="export-settings">
            <div className="setting-group">
              <label>Document Title</label>
              <input
                type="text"
                value={state.exportSettings.title}
                onChange={(e) => dispatch({
                  type: 'UPDATE_EXPORT_SETTINGS',
                  payload: { title: e.target.value }
                })}
              />
            </div>

            <div className="setting-group">
              <label>Page Size</label>
              <select
                value={state.exportSettings.pageSize}
                onChange={(e) => dispatch({
                  type: 'UPDATE_EXPORT_SETTINGS',
                  payload: { pageSize: e.target.value }
                })}
              >
                <option value="letter">US Letter (8.5" √ó 11")</option>
                <option value="a4">A4 (210mm √ó 297mm)</option>
              </select>
            </div>

            <div className="setting-group">
              <label>Layout Style</label>
              <div className="layout-options">
                <label className="layout-option">
                  <input
                    type="radio"
                    name="layout"
                    value="side-by-side"
                    checked={state.exportSettings.layout === 'side-by-side'}
                    onChange={(e) => dispatch({
                      type: 'UPDATE_EXPORT_SETTINGS',
                      payload: { layout: e.target.value }
                    })}
                  />
                  <div>
                    <strong>Side by Side</strong>
                    <div style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>
                      Image on left, text on right
                    </div>
                  </div>
                </label>
                <label className="layout-option">
                  <input
                    type="radio"
                    name="layout"
                    value="stacked"
                    checked={state.exportSettings.layout === 'stacked'}
                    onChange={(e) => dispatch({
                      type: 'UPDATE_EXPORT_SETTINGS',
                      payload: { layout: e.target.value }
                    })}
                  />
                  <div>
                    <strong>Stacked</strong>
                    <div style={{ fontSize: '0.875rem', color: 'var(--text-secondary)' }}>
                      Image on top, text below
                    </div>
                  </div>
                </label>
              </div>
            </div>
          </div>

          <div className="export-summary">
            <h3>Summary</h3>
            <div className="export-summary-item">
              <span>Total Images:</span>
              <strong>{state.images.length}</strong>
            </div>
            <div className="export-summary-item">
              <span>Estimated Pages:</span>
              <strong>{state.images.length + 1}</strong>
            </div>
            <div className="export-summary-item">
              <span>Layout:</span>
              <strong>{state.exportSettings.layout === 'side-by-side' ? 'Side by Side' : 'Stacked'}</strong>
            </div>
          </div>

          {exporting && (
            <div>
              <div className="progress-bar">
                <div className="progress-fill" style={{ width: `${progress}%` }}></div>
              </div>
              <p style={{ textAlign: 'center', color: 'var(--text-secondary)', fontSize: '0.875rem' }}>
                Generating document... {Math.round(progress)}%
              </p>
            </div>
          )}

          <div className="export-actions">
            <button
              className="btn btn-secondary"
              onClick={() => dispatch({ type: 'SET_VIEW_MODE', payload: 'edit' })}
              disabled={exporting}
            >
              ‚Üê Back to Editor
            </button>
            <button
              className="btn btn-primary"
              onClick={handleExport}
              disabled={exporting || state.images.length === 0}
            >
              {exporting ? 'Exporting...' : 'Export to DOCX'}
            </button>
          </div>
        </div>
      );
    };

    // Main App
    const App = () => {
      const [state, dispatch] = useReducer(appReducer, initialState);

      return (
        <div className="app-container">
          <Header state={state} dispatch={dispatch} />
          
          {state.viewMode === 'upload' && <UploadView state={state} dispatch={dispatch} />}
          {state.viewMode === 'edit' && <EditorView state={state} dispatch={dispatch} />}
          {state.viewMode === 'export' && <ExportView state={state} dispatch={dispatch} />}
        </div>
      );
    };

    // Render
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
